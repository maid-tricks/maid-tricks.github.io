{"version":3,"sources":["webpack:///../matrix-js-sdk/src/rust-crypto/RoomEncryptor.ts","webpack:///../matrix-js-sdk/src/rust-crypto/OutgoingRequestProcessor.ts","webpack:///../matrix-js-sdk/src/rust-crypto/KeyClaimManager.ts","webpack:///../matrix-js-sdk/src/rust-crypto/rust-crypto.ts","webpack:///../matrix-js-sdk/src/rust-crypto/index.ts"],"names":["RoomEncryptor","constructor","olmMachine","keyClaimManager","outgoingRequestProcessor","room","encryptionSettings","_defineProperty","this","prefixedLogger","logger","withPrefix","roomId","onCryptoEvent","config","JSON","stringify","error","onRoomMembership","member","debug","membership","userId","shouldEncryptForInvitedMembers","updateTrackedUsers","UserId","algorithm","Error","members","getEncryptionTargetMembers","map","u","userList","ensureSessionsForUsers","rustEncryptionSettings","EncryptionSettings","shareMessages","shareRoomKey","RoomId","m","makeOutgoingRequest","invalidateGroupSession","info","event","ensureEncryptionSession","encryptedContent","encryptRoomEvent","getType","getContent","makeEncrypted","EventType","RoomMessageEncrypted","parse","identityKeys","curve25519","toBase64","ed25519","OutgoingRequestProcessor","http","msg","resp","KeysUploadRequest","rawJsonRequest","Method","Post","body","KeysQueryRequest","KeysClaimRequest","SignatureUploadRequest","KeysBackupRequest","Put","ToDeviceRequest","path","encodeURIComponent","event_type","txn_id","RoomMessageRequest","room_id","warn","Object","getPrototypeOf","id","markRequestAsSent","type","method","queryParams","opts","json","headers","prefix","response","authedRequest","e","KeyClaimManager","currentClaimPromise","Promise","resolve","stop","stopped","prom","catch","then","ensureSessionsForUsersInner","claimRequest","getMissingSessions","RustCrypto","_userId","_deviceId","eventDecryptor","EventDecryptor","close","_room","getRoomId","encryptor","roomEncryptors","encryptEvent","attemptEventDecryption","getEventEncryptionInfo","_event$getSenderKey","ret","senderKey","getSenderKey","undefined","getWireContent","encrypted","authenticated","mismatchedSender","checkUserTrust","UserTrustLevel","checkDeviceTrust","deviceId","DeviceTrustLevel","prepareToEncrypt","forceDiscardSession","_this$roomEncryptors$","_ref","events","oneTimeKeysCounts","Map","unusedFallbackKeys","Set","devices","RustSdkCryptoJs","result","receiveSyncChanges","preprocessToDeviceMessages","mapOneTimeKeysCount","entries","setUnusedFallbackKeys","deviceLists","_deviceLists$changed","_deviceLists$left","changed","left","existingEncryptor","onSyncCompleted","syncState","outgoingRequestLoop","oldMembership","enc","keys","key","onRoomKeyUpdated","sessionId","toString","pendingList","getEventsPendingRoomKey","length","getId","ev","attemptDecryption","isRetry","_e","outgoingRequestLoopRunning","outgoingRequests","MapWithDefault","addEventToPendingList","res","decryptRoomEvent","event_id","getWireType","sender","getSender","state_key","getStateKey","content","origin_server_ts","getTs","removeEventFromPendingList","clearEvent","claimedEd25519Key","senderClaimedEd25519Key","senderCurve25519Key","forwardingCurve25519KeyChain","session","senderPendingEvents","eventsPendingKey","get","sessionPendingEvents","filter","sender_key","session_id","getOrCreate","add","delete","size","async","initRustCrypto","Trace","turnOn","d","initialize","RUST_SDK_STORE_PREFIX","rustCrypto","registerRoomKeyUpdatedCallback","sessions","onRoomKeysUpdated"],"mappings":"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","file":"bundles/713b08846cdbdfa5cd1c/37.js","sourceRoot":""}